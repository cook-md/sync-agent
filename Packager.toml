# cargo-packager configuration for Cook Sync
# Documentation: https://docs.crabnebula.dev/packager/

# Basic package information
name = "cook-sync"
product-name = "Cook Sync"
identifier = "com.cook.sync-agent"
version = "0.6.2"
authors = ["Alexey Dubovskoy"]
publisher = "Cook.md"
description = "CookCloud sync agent for syncing recipes with Cook.md"
homepage = "https://cook.md"
copyright = "Copyright (c) 2025 Cook.md"
license-file = "LICENSE"

# Build command to run before packaging
before-packaging-command = "cargo build --release"

# Resources to include in the package
resources = [
    "assets/icon*.png",
    "assets/package.*",
    "assets/cook-sync.desktop",
    "assets/entitlements.plist"
]

# Icons for all platforms
icons = ["assets/icon-256.png", "assets/icon-128.png", "assets/icon-48.png", "assets/icon-32.png"]

# Main binary configuration
[[binaries]]
path = "target/release/cook-sync"
main = true

# macOS-specific configuration
[macos]
minimum-system-version = "10.13"
# Entitlements file for code signing (enables hardened runtime automatically)
entitlements = "assets/entitlements.plist"
# Signing identity will be read from APPLE_SIGNING_IDENTITY environment variable
# Set in CI/CD or locally: export APPLE_SIGNING_IDENTITY="Developer ID Application: YOUR_NAME (TEAM_ID)"

[dmg]
window-size = { width = 660, height = 400 }
app-position = { x = 180, y = 170 }
application-folder-position = { x = 480, y = 170 }

# Linux AppImage configuration
[appimage]
# Bundle GTK3 and related libraries using linuxdeploy GTK plugin
# This ensures the system tray icon works on distributions without libappindicator
linuxdeployPlugins = { gtk = "https://raw.githubusercontent.com/linuxdeploy/linuxdeploy-plugin-gtk/master/linuxdeploy-plugin-gtk.sh" }

# Explicitly include libappindicator libraries for system tray support
libs = [
    "libappindicator3.so.1",
    "libdbusmenu-glib.so.4",
    "libdbusmenu-gtk3.so.4",
    "libindicator3.so.7"
]

# Exclude commonly available system libraries to reduce AppImage size
# These are expected to be present on all modern Linux distributions
excludedLibs = [
    "libc.so*",
    "libdl.so*",
    "libpthread.so*",
    "libm.so*",
    "libgcc_s.so*",
    "libstdc++.so*",
    "libX11.so*",
    "libxcb.so*"
]

# Windows NSIS configuration
[nsis]
installer-icon = "assets/package.ico"
installer-mode = "currentUser"
languages = ["English"]
compression = "lzma"
display-language-selector = false

# Windows MSI/WiX configuration
[wix]
fips-compliant = false
languages = ["en-US"]
