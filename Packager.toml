# cargo-packager configuration for Cook Sync
# Documentation: https://docs.crabnebula.dev/packager/

# Basic package information
name = "cook-sync"
product-name = "Cook Sync"
identifier = "com.cook.sync-agent"
version = "0.6.24"
authors = ["Alexey Dubovskoy"]
publisher = "Cook.md"
description = "CookCloud sync agent for syncing recipes with Cook.md"
homepage = "https://cook.md"
copyright = "Copyright (c) 2025 Cook.md"
license-file = "LICENSE"

# Resources to include in the package
resources = [
    "assets/icon*.png",
    "assets/package.*",
    "assets/cook-sync.desktop",
    "assets/entitlements.plist"
]

# Icons for all platforms
icons = ["assets/icon-256.png", "assets/icon-128.png", "assets/icon-48.png", "assets/icon-32.png"]

# Directory where binaries are located after cargo build --release
binariesDir = "target/release"

# Main binary configuration
[[binaries]]
path = "cook-sync"
main = true

# macOS-specific configuration
[macos]
minimum-system-version = "10.13"
# Entitlements file for code signing (enables hardened runtime automatically)
entitlements = "assets/entitlements.plist"
# Code signing identity (can be overridden by APPLE_SIGNING_IDENTITY environment variable)
signing-identity = "Developer ID Application: Alexey Dubovskoy (LNX77239P8)"

[dmg]
window-size = { width = 660, height = 400 }
app-position = { x = 180, y = 170 }
application-folder-position = { x = 480, y = 170 }

# Linux AppImage configuration
[appimage]
# Bundle GTK3 and related libraries using linuxdeploy GTK plugin
# This ensures the system tray icon works on distributions without libappindicator
linuxdeployPlugins = { gtk = "https://raw.githubusercontent.com/linuxdeploy/linuxdeploy-plugin-gtk/master/linuxdeploy-plugin-gtk.sh" }

# Explicitly include libayatana-appindicator3 libraries for system tray support
# libayatana-appindicator3 is the modern, actively maintained replacement for libappindicator3
# It's required for system tray icons to work across different desktop environments
libs = [
    # Core AppIndicator libraries (modern Ayatana versions)
    "libayatana-appindicator3.so.1",
    "libayatana-indicator3.so.7",

    # DBus menu libraries (required by AppIndicator)
    "libdbusmenu-glib.so.4",
    "libdbusmenu-gtk3.so.4",

    # Also include legacy libappindicator for compatibility with older systems
    # Some distributions may only have the legacy version available
    "libappindicator3.so.1",
    "libindicator3.so.7",

    # Additional GTK/GLib dependencies that may not be universally available
    "libatk-1.0.so.0",
    "libatk-bridge-2.0.so.0",
    "libatspi.so.0",
    "libcairo.so.2",
    "libcairo-gobject.so.2",
    "libpango-1.0.so.0",
    "libpangocairo-1.0.so.0",
    "libgdk-3.so.0",
    "libgdk_pixbuf-2.0.so.0",
    "libgio-2.0.so.0",
    "libglib-2.0.so.0",
    "libgmodule-2.0.so.0",
    "libgobject-2.0.so.0",
    "libgthread-2.0.so.0",
    "libgtk-3.so.0",

    # D-Bus libraries
    "libdbus-1.so.3"
]

# Exclude commonly available system libraries to reduce AppImage size
# These are expected to be present on all modern Linux distributions
excludedLibs = [
    "libc.so*",
    "libdl.so*",
    "libpthread.so*",
    "libm.so*",
    "libgcc_s.so*",
    "libstdc++.so*",
    "libX11.so*",
    "libxcb.so*",
    "libz.so*",
    "librt.so*"
]

# Windows NSIS configuration
[nsis]
installer-icon = "assets/package.ico"
installer-mode = "currentUser"
languages = ["English"]
compression = "lzma"
display-language-selector = false

# Windows MSI/WiX configuration
[wix]
fips-compliant = false
languages = ["en-US"]
